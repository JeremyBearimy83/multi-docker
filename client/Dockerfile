FROM NODE:ALPINE  


# IN THE DEVELOPMENT PHASE OF OUR MULTICONTANER SETUP BROWSER MAKES A REQUEST TO THE NGINX SERVER WHICH IS SPECIFIALLY 
# FOR ROUTING, MAKING SURE THE REQUEST GOES TO THE CORRECT SERVICE REACT SERVER OR EXPRESS SERVER

# BROWSWER MAKES REQUESTO TO NGINX

# WHEN WE MOVE INTO PRODUCTION, WE NEED TO TAKE CARE OF THE 3000 PORT, SO WE NEED TO MAKE SURE NGINX SHOWS PORT 3000 
# AND GIVES USERS ACCESS TO THIS ROUTE

# SO THIS TIME AROUND WE'LL HAVE ANOTHER NGINX SERVER TO SERVE PROD REACT FILES, WHICH IS LISTENING ON PORT 3000

#CHECK VIDEO 152 IN THE STEPHEN GRINDER COURSE

# FROM node:alpine as builder
FROM node:alpine 
WORKDIR '/app'
COPY package.json .

RUN npm install
COPY . . 

RUN npm run build

# PUTTING A SECOND FROM STATEMENT AUTOMATICALLY SAYS TO TERMINATE PREV BLOCK
FROM nginx
EXPOSE 3000 
COPY ./nginx/default.conf /etc/nginx/conf.d/default.conf
COPY --from=0 /app/build /usr/share/nginx/html

# RESULTANT IMAGE IS GOING TO BE AS BIG AS NGINX BASE IMAGE + COPY FROM 
# BUILD (NO DEPENDENCIES FROM THE BUILD PHASE)


# DEFAULT COMMAND OF NGINX IS STARTING NGINX

# TO RUN THIS:
# sudo docker run -p 8080:80 e39c6e79aaa4




